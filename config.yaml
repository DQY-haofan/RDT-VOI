# =====================================================================
# 快速实验配置 - 针对Colab环境优化
# =====================================================================

experiment:
  name: rdt_fast_experiment
  output_dir: runs
  seed: 202501

numerics:
  linear_solver_tol: 1.0e-07
  cholesky_nugget: 1.0e-08
  logdet_method: cholesky
  pcg_max_iter: 500

geometry:
  mode: grid2d
  nx: 40
  ny: 40
  h: 5.0

prior:
  nu: 1.0
  kappa: 0.10
  sigma2: 0.30
  alpha: 2
  beta: 1.0e-06
  mu_prior_mean: 2.2
  mu_prior_std: 0.0

sensors:
  pool_fraction: 0.75
  pool_strategy: grid_subsample
  type_mix: [0.4, 0.4, 0.2]
  types:
    - name: inertial_profiler
      noise_std: 0.1
      cost_gbp: 10000.0
      footprint: avg3x3
    - name: photogrammetry
      noise_std: 0.25
      cost_gbp: 5000.0
      footprint: avg3x3
    - name: smartphone
      noise_std: 0.5
      cost_gbp: 500.0
      footprint: avg5x5

decision:
  tau_iri: 2.0
  L_TP_gbp: 5000.0
  L_FP_gbp: 8000.0
  L_FN_gbp: 40000.0
  L_TN_gbp: 0.0

# =====================================================================
# 🔥 选择算法优化（关键加速点）
# =====================================================================
selection:
  methods:
    - greedy_mi        # 必跑
    - greedy_aopt      # 🔥 启用但大幅优化
    - uniform          # 快速基线
    - random           # 快速基线

  budgets:
    - 10
    - 20
    - 40

  greedy_mi:
    lazy: true
    cost_normalized: true
    warmstart_enum: false
    batch_size: 64           # 批量评估大小

  greedy_aopt:
    lazy: true
    trace_estimator: hutchpp
    hutchpp_probes: 5        # 🔥 减少到5（原10）
    batch_size: 16           # 🔥 减少到16（原32）
    max_candidates: 150      # 🔥 新增：只评估150个候选
    early_stop_ratio: 0.15   # 🔥 新增：当最佳增益<初始15%时停止

# =====================================================================
# EVI计算优化
# =====================================================================
evi:
  compute_for:
    - greedy_mi
  method: monte_carlo
  monte_carlo_samples: 500
  unscented_alpha: 1.0
  unscented_beta: 2.0
  unscented_kappa: 0.0

# =====================================================================
# CV优化
# =====================================================================
cv:
  scheme: spatial_block
  k_folds: 3
  buffer_width_multiplier: 1.5
  block_strategy: kmeans
  ensure_connected: true

# =====================================================================
# UQ优化
# =====================================================================
uq:
  bootstrap_method: spatial_block
  bootstrap_samples: 500
  confidence_level: 0.95
  coverage_percentile: 90
  compute_crps: false

diagnostics:
  morans_i:
    permutations: 499
    weight_type: adjacency
  calibration:
    compute_coverage: true
    compute_msse: true

# =====================================================================
# 🔥 增强的可视化配置（专家建议）
# =====================================================================
plots:
  save_formats: [png, pdf]   # 🔥 恢复pdf（论文需要）
  dpi: 300                    # 🔥 恢复高分辨率
  style: seaborn-v0_8-paper

  budget_curves:
    show_ci: true
    metrics:
      - expected_loss
      - rmse
      - coverage_90

  performance_profile:
    tau_max: 3.0

  critical_difference:
    alpha: 0.05
    test: nemenyi

  # 🔥 新增：专家建议的图像
  expert_plots:
    enable_all: true           # 启用所有专家建议的图

    marginal_efficiency:       # F2: 单位成本效率曲线
      enable: true
      show_cost_normalized: true

    type_composition:          # F3: 传感器类型堆叠
      enable: true
      show_stacked: true

    mi_voi_correlation:        # F4: MI vs VoI相关性
      enable: true
      compute_r2: true

    calibration_plots:         # F5: 校准图
      enable: true
      coverage_curve: true
      msse_distribution: true

    spatial_diagnostics:       # F6: 空间诊断
      enable: true
      show_test_blocks: true

    ablation_study:            # F8: 消融实验
      enable: false            # 暂不启用（耗时）

    sensor_placement_map:      # F10: 选址可视化
      enable: true
      show_budget_evolution: true

logging:
  level: INFO
  console: true
  file: true
  jsonl_metrics: true

acceptance:
  m1_grid_size: 1600
  m1_budgets: [10, 20, 40]
  m1_check_monotonic: true
  m1_check_diminishing: true
  m2_min_improvement_vs_random: 0.15
  m2_confidence_level: 0.95
  m3_small_instance_n: 200
  m3_small_instance_k: 8
  m3_max_suboptimality: 1.58
  m4_morans_alpha: 0.05
  m4_coverage_tolerance: 0.05
  m4_msse_tolerance: 0.2