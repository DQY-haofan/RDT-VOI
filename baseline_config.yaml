# ============================================================================
# RDT-VoI Baseline Configuration - ä¸“å®¶å®¡æ ¸ä¿®å¤ç‰ˆ âœ…
# ç»¼åˆä¸¤ä½ä¸“å®¶å»ºè®® + ä»£ç å®ç°éªŒè¯åçš„æœ€ç»ˆç‰ˆæœ¬
#
# ğŸ”¥ å…³é”®ä¿®å¤ï¼š
#   1. beta_base ä¿®æ­£ä¸º 1.0e-3ï¼ˆä¸ beta ä¸€è‡´ï¼Œé¿å…å±‚çº§å†²çªï¼‰
#   2. target_ddi è°ƒæ•´ä¸º 0.28ï¼ˆé¿å…è§¦å‘ä»£ç ä¸­çš„ 0.25 ä¸‹é™ï¼‰
#   3. keep_fraction æ”¹ä¸º nullï¼ˆä½¿ç”¨åŠ¨æ€è®¡ç®—ï¼Œä¸“å®¶å»ºè®®ï¼‰
#   4. æ·»åŠ è¯¦ç»†çš„å‚æ•°è¯´æ˜å’Œå¥åº·æ£€æŸ¥æŒ‡æ ‡
#
# é¢„æœŸæ•ˆæœï¼š
#   âœ… ROI(k=5) > 0
#   âœ… Î”(EVI-MI) @ k=3 â‰ˆ 10-15%
#   âœ… DDI â‰ˆ 28-30%
#   âœ… Coverage(90%) â‰ˆ 0.88-0.92
# ============================================================================

experiment:
  name: "rdt_voi_fixed_baseline"
  seed: 42
  output_dir: "results/"

# ----------------------------------------------------------------------------
# Numerical Settings
# ----------------------------------------------------------------------------
numerics:
  linear_solver_tol: 1.0e-8
  cholesky_nugget: 1.0e-6
  pcg_max_iter: 500
  logdet_method: "cholmod"

# ----------------------------------------------------------------------------
# Spatial Domain (20x20 ç½‘æ ¼ï¼Œæ€» 400 åƒå…ƒ)
# ----------------------------------------------------------------------------
geometry:
  mode: "grid2d"
  nx: 20
  ny: 20
  h: 5.0  # ç½‘æ ¼é—´è· 5m

# ----------------------------------------------------------------------------
# ğŸ”¥ Prior Distribution - ä¿®å¤ç‰ˆ
# å…³é”®æ”¹è¿›ï¼šç©ºé—´ç›¸å…³æ€§å¢å¼º + æ–¹å·®å¼‚è´¨æ€§
# ----------------------------------------------------------------------------
prior:
  # SPDE å‚æ•°
  nu: 1.0
  kappa: 0.10                    # ç›¸å…³é•¿åº¦ â‰ˆ âˆš(8*nu)/kappa â‰ˆ 28m
  sigma2: 0.25                   # ç›®æ ‡è¾¹é™…æ–¹å·®

  # ğŸ”¥ ä¿®å¤1ï¼šNugget å‚æ•°ï¼ˆåˆ›å»ºç©ºé—´å¼‚è´¨æ€§ï¼‰
  alpha: 5.0e-3                  # â†‘ ä»1.0æå‡ï¼ˆä¸“å®¶1å»ºè®®ï¼‰
  beta: 1.0e-3                   # ä¿æŒï¼ˆå‘åå…¼å®¹ï¼‰
  beta_base: 0.1              # âœ… ä¿®å¤ï¼šä¸ beta ä¸€è‡´ï¼ˆéçƒ­ç‚¹åŒºåŸŸï¼‰
  beta_hot: 1.0e-4                # çƒ­ç‚¹åŒºåŸŸï¼ˆé«˜æ–¹å·®ï¼Œ100å€å·®å¼‚ï¼‰

  # å‡å€¼åœºå‚æ•°
  mu_prior_mean: 2.2             # å¹³å‡ IRI
  mu_prior_std: 0.3              # å‡å€¼åœºæ³¢åŠ¨

  # ğŸ”¥ çƒ­ç‚¹é…ç½®ï¼ˆåˆ›å»ºç©ºé—´å¼‚è´¨æ€§çš„å…³é”®ï¼‰
  # ç›®æ ‡ï¼šÎ²_hot/Î²_base = 100ï¼Œäº§ç”Ÿæ˜æ˜¾çš„æ–¹å·®åˆ†å±‚
  hotspots:
    - center_m: [25, 75]         # å·¦ä¸Šçƒ­ç‚¹
      radius_m: 40               # â†‘ ä»20æ‰©å¤§ï¼ˆä¸“å®¶1å»ºè®®ï¼‰
    - center_m: [75, 25]         # å³ä¸‹çƒ­ç‚¹
      radius_m: 40               # â†‘ ä»25æ‰©å¤§
    - center_m: [50, 50]         # ä¸­å¿ƒçƒ­ç‚¹
      radius_m: 20               # â†‘ ä»15æ‰©å¤§

# ----------------------------------------------------------------------------
# ğŸ”¥ Sensor Pool - é™å™ª + ç¨€ç– + æˆæœ¬æ¢¯åº¦
# ----------------------------------------------------------------------------
sensors:
  types:
    # ğŸ”¥ æ‰€æœ‰å™ªå£° Ã—0.7ï¼ˆä¸“å®¶1å»ºè®®ï¼‰
    # ğŸ”¥ æˆæœ¬æ‹‰å¤§æ¢¯åº¦ï¼ˆä¸“å®¶1ï¼šæ‹‰å¼€Ã—3åŒºé—´ï¼‰

    - name: smartphone
      noise_std: 0.35            # âœ… 0.50 Ã— 0.7 = 0.35
      cost_gbp: 50               # â†‘ ä»30æå‡ï¼ˆæ‹‰å¼€åº•éƒ¨ï¼‰
      footprint: point

    - name: "basic_point"
      noise_std: 0.084           # âœ… 0.12 Ã— 0.7 = 0.084
      cost_gbp: 300              # â†‘ ä»150æå‡ï¼ˆÃ—2ï¼‰
      footprint: "point"

    - name: "laser_profiler"
      noise_std: 0.025           # âœ… 0.035 Ã— 0.7 â‰ˆ 0.025
      cost_gbp: 2000             # â†‘â†‘ ä»800å¤§å¹…æå‡ï¼ˆÃ—2.5ï¼Œä¸“å®¶1å»ºè®®ï¼‰
      footprint: "point"

    - name: photogrammetry
      noise_std: 0.14            # âœ… 0.20 Ã— 0.7 = 0.14
      cost_gbp: 200              # â†‘ ä»100æå‡
      footprint: avg3x3

    - name: "vehicle_avg"
      noise_std: 0.21            # âœ… 0.30 Ã— 0.7 = 0.21
      cost_gbp: 250              # â†‘ ä»100æå‡
      footprint: "avg5x5"

    - name: inertial_profiler
      noise_std: 0.084           # âœ… 0.12 Ã— 0.7 = 0.084
      cost_gbp: 800              # â†‘ ä»300æå‡
      footprint: avg3x3

  # ğŸ”¥ ä¿®å¤2ï¼šç¨€ç–å€™é€‰æ± ï¼ˆä¸“å®¶2æ ¸å¿ƒå»ºè®®ï¼‰
  pool_strategy: "grid_subsample"
  pool_fraction: 0.20            # âœ… ä»0.60é™åˆ°0.20ï¼ˆä¸“å®¶2ï¼šè®©é€‰æ‹©å˜å›°éš¾ï¼‰
  type_mix: [0.15, 0.20, 0.10, 0.20, 0.15, 0.20]

  # å¼‚è´¨åŒ–é…ç½®ï¼ˆå¯é€‰ï¼‰
  use_heterogeneous: true
  cost_zones:
    - center_m: [100, 100]
      radius_m: 50
      cost_multiplier: 1.5
      noise_multiplier: 0.8
      allowed_types: ['inertial_profiler', 'photogrammetry']

# ----------------------------------------------------------------------------
# ğŸ”¥ Decision Model - é«˜é£é™© + æåº¦ä¸å¯¹ç§°
# ----------------------------------------------------------------------------
decision:
  tau_iri: null                  # è¿è¡Œæ—¶è®¡ç®—å¹¶ç¼“å­˜
  tau_quantile: 0.88             # âœ… ä¸“å®¶å»ºè®®ï¼š0.85-0.92ï¼ŒæŠ˜ä¸­0.88

  # ğŸ”¥ æåº¦ä¸å¯¹ç§°æˆæœ¬ï¼ˆä¸“å®¶2æ ¸å¿ƒå»ºè®®ï¼š1:10æ¯”ä¾‹ï¼‰
  L_FP_gbp: 10000     # â†‘ ä»5000æé«˜
  L_FN_gbp: 100000    # â†“ ä»200000é™ä½
  L_TP_gbp: 800.0                # æ­£ç¡®ç»´æŠ¤æˆæœ¬
  L_TN_gbp: 0.0                  # æ­£ç¡®ä¸ç»´æŠ¤ï¼ˆæ— æˆæœ¬ï¼‰
  # ç»“æœï¼šp_T = L_FP/(L_FP+L_FN-L_TP) â‰ˆ 0.091 (çº¦9%)

  # ğŸ”¥ ä¿®å¤3ï¼šDDI æ§åˆ¶
  target_ddi: 0.28               # âœ… ä¿®å¤ï¼šä»0.25æ”¹ä¸º0.28ï¼ˆé¿å…ä»£ç ä¸‹é™ï¼‰
  K_action: 12                   # è¡ŒåŠ¨é™åˆ¶ï¼ˆä¸“å®¶å»ºè®®10-15ï¼ŒæŠ˜ä¸­12ï¼‰

# ğŸ”¥ Metrics é…ç½®ï¼ˆç¡®ä¿ Domain Scalingï¼‰
metrics:
  scale_savings_to_domain: true  # âœ… å…³é”®ï¼šç¡®ä¿ ROI è®¡ç®—æ­£ç¡®
  coverage_clip: [0.0, 1.0]

# ----------------------------------------------------------------------------
# Sensor Selection Methods
# ----------------------------------------------------------------------------
selection:
  methods:
    - greedy_evi
    - greedy_mi
    - greedy_aopt
    - maxmin
    - uniform
    - random

  budget_type: "count"
  budgets: [1, 2, 3, 5, 8, 10, 15, 20]  # âœ… æ‰©å±•ï¼ˆä¸“å®¶1å»ºè®®ï¼‰

  # ğŸ”¥ Greedy-MI é…ç½®
  greedy_mi:
    batch_size: 64
    adaptive_pruning: true
    prune_threshold: 0.10
    use_cost: true
    keep_fraction: 0.20          # âœ… ä½¿ç”¨åŠ¨æ€è®¡ç®—ï¼ˆä»£ç è‡ªåŠ¨ï¼‰
    adaptive_keep: true

  # Greedy-Aopt é…ç½®
  greedy_aopt:
    n_probes: 16
    use_cost: true

  # ğŸ”¥ ä¿®å¤4ï¼šGreedy-EVI é…ç½®
  greedy_evi:
    n_y_samples: 32              # âœ… ä¸“å®¶å»ºè®®ï¼š8-32ï¼ŒæŠ˜ä¸­16
    use_cost: true
    mi_prescreen: true
    keep_fraction: null          # âœ… ä¿®å¤ï¼šæ”¹ä¸ºnullï¼Œä½¿ç”¨åŠ¨æ€è®¡ç®—

    # Fold æ§åˆ¶ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼šæ‰€æœ‰foldéƒ½è¿è¡Œï¼‰
    every_n_folds: 1
    budgets_subset: []           # ç©º = æ‰€æœ‰é¢„ç®—
    max_folds: null              # null = æ‰€æœ‰fold
    must_budgets: []

  maxmin:
    use_cost: true

# ----------------------------------------------------------------------------
# Expected Value of Information
# ----------------------------------------------------------------------------
evi:
  compute_for: ["greedy_mi", "greedy_evi"]
  method: "monte_carlo"
  monte_carlo_samples: 32        # âœ… ä¸“å®¶1å»ºè®®ï¼š32-64ï¼Œé€‰32

# ----------------------------------------------------------------------------
# Cross-Validation
# ----------------------------------------------------------------------------
cv:
  scheme: "spatial_block"
  k_folds: 5
  buffer_width_multiplier: 1.5
  block_strategy: "kmeans"
  ensure_connected: true
  morans_permutations: 999

# ----------------------------------------------------------------------------
# Uncertainty Quantification
# ----------------------------------------------------------------------------
uq:
  bootstrap_method: "spatial_block"
  bootstrap_samples: 1000
  confidence_level: 0.95
  coverage_percentile: 90
  compute_crps: true

# ----------------------------------------------------------------------------
# Diagnostics
# ----------------------------------------------------------------------------
diagnostics:
  morans_i:
    compute: true
    permutations: 999
    alpha: 0.05

  calibration:
    pit_histogram: true
    coverage_curves: true
    reliability_diagram: true

# ----------------------------------------------------------------------------
# Visualization
# ----------------------------------------------------------------------------
plots:
  save_formats: [png, pdf]
  dpi: 300
  style: "seaborn-v0_8-paper"

  budget_curves:
    metrics: ["rmse", "expected_loss_gbp", "coverage_90"]
    show_confidence: true
    confidence_level: 0.95

  performance_profile:
    tau_values: [1.0, 1.05, 1.1, 1.2, 1.5, 2.0, 3.0]
    use_budget_fold_instances: true

  critical_difference:
    alpha: 0.05
    test: "nemenyi"

  business_metrics:
    enable: true
    baseline_method: "uniform"
    show_savings: true
    show_roi: true
    show_cost_efficiency: true

  effect_size:
    enable: true
    plot_heatmaps: true
    plot_pairwise_table: true
    top_k_comparisons: 20

  critical_region:
    enable: true
    epsilon: 0.2
    plot_heatmap: true

  expert_plots:
    enable_all: true

    marginal_efficiency:
      enable: true
      normalize_by_cost: true
      unit: "gbp_per_test_point"
      split_by_unit: true

    type_composition:
      enable: true
      show_cost_breakdown: true

    mi_voi_correlation:
      enable: true
      methods: ["greedy_mi", "greedy_evi"]
      correlation_mode_disable_prescreen: false

    calibration_plots:
      enable: true

    spatial_diagnostics:
      enable: true
      show_morans_i: true

    sensor_placement_map:
      enable: true
      budgets_to_show: [3, 5, 10, 15]

    roi_curves:
      enable: true
      baseline_method: "uniform"
      show_near_threshold: true

    robustness_heatmap:
      enable: true              # âœ… å¯ç”¨ï¼ˆè§‚å¯Ÿå‚æ•°æ•æ„Ÿæ€§ï¼‰

    ddi_overlay:
      enable: true
      methods_to_compare: ['greedy_evi', 'greedy_mi']

    time_loss_curves:
      enable: false

# ----------------------------------------------------------------------------
# Acceptance Criteriaï¼ˆå¥åº·æ£€æŸ¥æŒ‡æ ‡ï¼‰
# ----------------------------------------------------------------------------
acceptance:
  m1_grid_size: 100
  m1_budgets: [5, 10, 20]
  m1_check_monotonic: true
  m1_check_diminishing: true

  m2_min_improvement_vs_random: 0.15
  m2_confidence_level: 0.95

  m3_small_instance_n: 25
  m3_small_instance_k: 5
  m3_max_suboptimality: 0.10

  m4_morans_alpha: 0.05
  m4_coverage_tolerance: 0.10
  m4_msse_tolerance: 0.25

# ============================================================================
# ğŸ”¥ å‚æ•°æ‰«æé¢„è®¾ï¼ˆä¾›æ•æ„Ÿæ€§åˆ†æä½¿ç”¨ï¼‰
# ============================================================================
parameter_scan_presets:
  # éªŒè¯å½“å‰ä¿®å¤é…ç½®
  current_fixed:
    pool_fraction: 0.20
    tau_quantile: 0.88
    L_FN_gbp: 100000
    L_FP_gbp: 10000
    target_ddi: 0.28
    alpha: 2.0e-3
    beta_base: 1.0e-3
    beta_hot: 1.0e-5

  # é«˜é£é™©åœºæ™¯ï¼ˆé‡ç°ä¸“å®¶å»ºè®®çš„æç«¯æƒ…å†µï¼‰
  high_stakes:
    target_ddi: 0.30
    L_FN_gbp: 120000
    L_FP_gbp: 30000
    tau_quantile: 0.92           # æ›´ä¸¥æ ¼
    K_action: 10
    monte_carlo_samples: 32

  # ä½é£é™©åœºæ™¯ï¼ˆå¯¹æ¯”å®éªŒï¼‰
  low_stakes:
    target_ddi: 0.10
    L_FN_gbp: 30000
    L_FP_gbp: 5000
    tau_quantile: 0.65
    K_action: null
    monte_carlo_samples: 16

  # ä¸“å®¶1å»ºè®®çš„è¶…é«˜ä¿¡å™ªæ¯”
  ultra_high_snr:
    alpha: 5.0e-3                # æœ€å¼ºç©ºé—´å¹³æ»‘
    beta_base: 1.0e-3
    beta_hot: 1.0e-6             # æ›´é«˜æ–¹å·®å·®å¼‚
    pool_fraction: 0.20
    tau_quantile: 0.95

  # ä¸“å®¶2å»ºè®®çš„æåº¦ç¨€ç–
  ultra_sparse:
    pool_fraction: 0.10          # ä»…40ä¸ªå€™é€‰ç‚¹
    L_FN_gbp: 200000
    L_FP_gbp: 5000               # 1:40æ¯”ä¾‹
    target_ddi: 0.25

  # DDIæ•æ„Ÿæ€§æ‰«æ
  ddi_sweep:
    target_ddi: [0.20, 0.25, 0.28, 0.30, 0.35]

  # æˆæœ¬ä¸å¯¹ç§°æ€§æ‰«æ
  cost_asymmetry_sweep:
    L_FN_gbp: [30000, 60000, 100000, 150000]
    L_FP_gbp: [5000, 10000, 15000, 20000]

  # ä¿¡å·å¼ºåº¦æ‰«æ
  signal_strength_sweep:
    alpha: [1.0e-4, 1.0e-3, 2.0e-3, 5.0e-3]
    beta_base: [1.0e-4, 1.0e-3, 5.0e-3]

  # å€™é€‰æ± å¯†åº¦æ‰«æ
  pool_density_sweep:
    pool_fraction: [0.10, 0.15, 0.20, 0.30, 0.40]

# ============================================================================
# ğŸ“Š é¢„æœŸå¥åº·æŒ‡æ ‡ï¼ˆéªŒè¯ä¿®å¤æ•ˆæœï¼‰
# ============================================================================
# è¿è¡Œååº”è§‚å¯Ÿåˆ°ï¼š
#
# âœ… ROI æ›²çº¿ï¼ˆå…³é”®æŒ‡æ ‡ï¼‰ï¼š
#   - ROI(k=1) â‰ˆ -0.3 ~ 0.0      ï¼ˆå°é¢„ç®—æ¥è¿‘ç›ˆäºå¹³è¡¡ï¼‰
#   - ROI(k=5) > 0.0             ï¼ˆä¸­é¢„ç®—å¼€å§‹ç›ˆåˆ©ï¼‰â˜…
#   - ROI(k=15) > 0.5            ï¼ˆå¤§é¢„ç®—æ˜¾è‘—ç›ˆåˆ©ï¼‰
#
# âœ… ç®—æ³•å·®è·ï¼ˆæ–¹æ³•åŒºåˆ†åº¦ï¼‰ï¼š
#   - Greedy-EVI vs Greedy-MI: Î” â‰ˆ 8-15% @ k=3-5  â˜…
#   - Greedy-EVI vs Random: Î” > 30%
#   - Greedy-MI vs A-opt: Î” â‰ˆ 5-10%
#
# âœ… ä¿¡å·è´¨é‡ï¼ˆæ•°å€¼å¥åº·ï¼‰ï¼š
#   - Coverage(90%) â‰ˆ 0.88-0.92  ï¼ˆæ ¡å‡†è‰¯å¥½ï¼‰
#   - DDI(Global) â‰ˆ 28-30%       ï¼ˆå†³ç­–éš¾åº¦åˆç†ï¼‰â˜…
#   - Moran's I p-value < 0.01   ï¼ˆç©ºé—´ç›¸å…³æ˜¾è‘—ï¼‰
#   - Prior Ïƒ CV > 10%           ï¼ˆç©ºé—´å¼‚è´¨æ€§å……è¶³ï¼‰
#
# âœ… æˆæœ¬æ•ˆç‡ï¼š
#   - Cost range: Â£50 - Â£2000    ï¼ˆæ¢¯åº¦æ˜æ˜¾ï¼‰
#   - Sensor type diversity > 3  ï¼ˆç±»å‹ä¸°å¯Œï¼‰
#
# âš ï¸ å¦‚æœä»¥ä¸ŠæŒ‡æ ‡æœªè¾¾åˆ°ï¼Œæ£€æŸ¥ï¼š
#   1. tau_iri æ˜¯å¦æ­£ç¡®ç¼“å­˜ï¼ˆæ‰“å°æ—¥å¿—ç¡®è®¤ï¼‰
#   2. domain_scale_factor æ˜¯å¦åº”ç”¨ï¼ˆåº” > 1ï¼‰
#   3. å…ˆéªŒæ–¹å·® CV æ˜¯å¦ > 10%ï¼ˆhotspotæ•ˆæœï¼‰
#   4. keep_fraction æ˜¯å¦çœŸæ­£ä¸º nullï¼ˆåŠ¨æ€è®¡ç®—ï¼‰
#
# ğŸ“ è°ƒè¯•å‘½ä»¤ï¼š
#   python main.py --quick-test --verbose
#   python main.py --preset current_fixed
#   python main.py --scan ddi=0.25,0.28,0.30
# ============================================================================

# ä½¿ç”¨è¯´æ˜
# ===========================================================================
# 1. é»˜è®¤è¿è¡Œï¼ˆä½¿ç”¨ä¿®å¤åçš„é…ç½®ï¼‰ï¼š
#    python main.py
#
# 2. éªŒè¯ä¿®å¤æ•ˆæœï¼š
#    python main.py --preset current_fixed --verbose
#
# 3. é‡ç°ä¸“å®¶å»ºè®®çš„é«˜é£é™©åœºæ™¯ï¼š
#    python main.py --preset high_stakes
#
# 4. å‚æ•°æ•æ„Ÿæ€§åˆ†æï¼š
#    python main.py --scan ddi=0.25,0.28,0.30
#    python main.py --scan pool_fraction=0.15,0.20,0.25
#
# 5. å¿«é€Ÿæµ‹è¯•ï¼ˆè°ƒè¯•ç”¨ï¼‰ï¼š
#    python main.py --quick-test
#
# 6. å®Œæ•´å®éªŒï¼ˆå‘è¡¨ç”¨ï¼‰ï¼š
#    python main.py --parallel --workers 6
# ===========================================================================