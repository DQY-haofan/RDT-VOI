# ============================================================================
# RDT-VoI Configuration - OPTIMIZED V2 (Based on Log Analysis)
# Road Deterioration Testing: Value of Information Framework
#
# ğŸ”¥ æ ¸å¿ƒä¼˜åŒ–ï¼ˆåŸºäº 43åˆ†é’Ÿè¿è¡Œæ—¥å¿—åˆ†æï¼‰:
#   1. é˜ˆå€¼æ”¹ä¸ºå…ˆéªŒé«˜åˆ†ä½æ•°ï¼ˆÏ„ = quantile(Î¼, 0.88)ï¼‰
#   2. åŠ å¤§è¯¯åˆ¤ä»£ä»·æ¯”ï¼ˆFN:FP = 20:1ï¼Œä» 15:1 æå‡ï¼‰
#   3. EVI é¢„ç­›æ”¾å®½åˆ° 0.7ï¼ˆä» 0.25ï¼‰
#   4. å¢åŠ ç¨€ç–æ± åœºæ™¯
#   5. å¯ç”¨è´§å¸é¢„ç®—ï¼ˆå¯é€‰ï¼‰
# ============================================================================

experiment:
  name: "rdt_voi_v2_optimized"
  seed: 42
  output_dir: "results/v2_optimized"

# ----------------------------------------------------------------------------
# Numerical Settings
# ----------------------------------------------------------------------------
numerics:
  linear_solver_tol: 1.0e-8
  cholesky_nugget: 1.0e-6
  pcg_max_iter: 500
  logdet_method: "cholmod"

# ----------------------------------------------------------------------------
# Spatial Domain
# ----------------------------------------------------------------------------
geometry:
  mode: "grid2d"
  nx: 30
  ny: 30
  h: 5.0

# ----------------------------------------------------------------------------
# Prior Distribution (GMRF/SPDE) - âœ“ CV=30% (å·²éªŒè¯ä¼˜ç§€)
# ----------------------------------------------------------------------------
prior:
  nu: 1.0
  kappa: 0.10
  sigma2: 0.30
  alpha: 2
  beta: 1.0e-6
  mu_prior_mean: 2.2
  mu_prior_std: 0.3

  # ğŸ”¥ æ–°å¢ï¼ˆå¦‚æœæ²¡æœ‰çš„è¯ï¼‰
  beta_base: 2.0      # ä» 5e-2 å¢å¤§åˆ° 2.0ï¼ˆ40å€ï¼‰âš¡
  beta_hot: 1.0e-3    # ä» 1e-4 å¢å¤§åˆ° 1e-3ï¼ˆ10å€ï¼‰


  hotspots:
    - center_m: [50, 50]
      radius_m: 40      # ä» 40 å‡åˆ° 25

    - center_m: [150, 50]
      radius_m: 30      # ä» 30 å‡åˆ° 20

    - center_m: [100, 100]
      radius_m: 30      # ä» 45 å‡åˆ° 30

# ----------------------------------------------------------------------------
# Sensor Pool Configuration - OPTIMIZED V2
# ----------------------------------------------------------------------------
sensors:

  types:
    # æä¾¿å®œä½†å™ªå£°æå¤§
    - name: smartphone
      noise_std: 0.50
      cost_gbp: 30
      footprint: point

    # ä¸­ç­‰ç²¾åº¦+ä¸­ç­‰æˆæœ¬
    - name: "basic_point"
      noise_std: 0.15
      cost_gbp: 150
      footprint: "point"

    # æé«˜ç²¾åº¦+æé«˜æˆæœ¬
    - name: "laser_profiler"
      noise_std: 0.05
      cost_gbp: 800
      footprint: "point"

    # å¤§è¶³è¿¹+ä¸­é«˜å™ªå£°
    - name: photogrammetry
      noise_std: 0.25
      cost_gbp: 100
      footprint: avg3x3

    # æå¤§è¶³è¿¹+é«˜å™ªå£°
    - name: "vehicle_avg"
      noise_std: 0.35
      cost_gbp: 100
      footprint: "avg5x5"

    - name: inertial_profiler
      noise_std: 0.15
      cost_gbp: 300
      footprint: avg3x3

  pool_strategy: "grid_subsample"

  # ğŸ”¥ å…³é”®æ”¹åŠ¨ï¼šç¨€ç–æ± ï¼ˆä» 0.3 é™åˆ° 0.15ï¼‰
  pool_fraction: 0.5  # âœ… è®©"é€‰é”™"çš„ä»£ä»·æ›´å¤§

  type_mix: [0.3, 0.4, 0.3]

  # ğŸ”¥ æ–°å¢ï¼šå¼‚è´¨åŒ–é…ç½®
  use_heterogeneous: true
  cost_zones:  # ğŸ”¥ æ–°å¢æˆæœ¬åˆ†åŒº
    - center_m: [100, 100]
      radius_m: 50
      cost_multiplier: 1.5
      noise_multiplier: 0.8
      allowed_types: ['inertial_profiler', 'photogrammetry']

# ----------------------------------------------------------------------------
# Decision Model - ğŸ”¥ ä¼˜åŒ– V2ï¼ˆæ‹‰å¤§ä»»åŠ¡éš¾åº¦ï¼‰
# ----------------------------------------------------------------------------
decision:
  # ğŸ”¥ å…³é”®æ”¹åŠ¨ 1ï¼šä½¿ç”¨åˆ†ä½æ•°é˜ˆå€¼ï¼ˆè€Œéå›ºå®šå€¼ï¼‰
  tau_iri: null         # å¦‚æœç”¨åŠ¨æ€é˜ˆå€¼ï¼Œè®¾ä¸º null
  tau_quantile: 0.75    # æˆ–è€…ä¿ç•™æ‚¨åŸæœ‰çš„å›ºå®šå€¼

  # ğŸ”¥ å…³é”®æ”¹åŠ¨ 2ï¼šåŠ å¤§è¯¯åˆ¤ä»£ä»·æ¯”
  L_FP_gbp: 500.0      # ä¿æŒæˆ–ä¿®æ”¹
  L_FN_gbp: 10000.0    # ğŸ”¥ å¢å¤§åˆ° FP çš„ 10-20 å€
  L_TP_gbp: 800.0
  L_TN_gbp: 0.0
  # ğŸ”¥ æ–°å¢ï¼šDDI æ§åˆ¶
  target_ddi: 0.30  # ç›®æ ‡ï¼š30% åƒå…ƒåœ¨é˜ˆå€¼é™„è¿‘

  # ğŸ”¥ æ–°å¢ï¼šè¡ŒåŠ¨çº¦æŸ
  K_action: 20  # æœ€å¤šç»´æŠ¤ 20 ä¸ªä½ç½®


  # ğŸ¯ æˆæœ¬æ¯”ä¾‹: FN:FP = 120k:6k = 20:1 âœ“

# ----------------------------------------------------------------------------
# Sensor Selection Methods
# ----------------------------------------------------------------------------
selection:
  methods:
    - greedy_mi
    - greedy_aopt
    - greedy_evi
    - maxmin
    - uniform
    - random

  # ğŸ”¥ å¯é€‰ï¼šæ”¹ä¸ºè´§å¸é¢„ç®—ï¼ˆå½“å‰ä»ç”¨å°æ•°ï¼‰
  budget_type: "count"     # "count" æˆ– "monetary"

  # å°æ•°é¢„ç®—ï¼ˆç¨€ç¼ºæ®µåŠ å¯†ï¼‰
  budgets: [3, 8, 15, 20, 30, 40]

  # è´§å¸é¢„ç®—ï¼ˆå¯é€‰ï¼Œå½“ budget_type="monetary" æ—¶å¯ç”¨ï¼‰
  # budgets_gbp: [500, 1000, 2000, 3000, 5000, 8000, 12000, 20000]

  # Method-specific configurations
  greedy_mi:
    batch_size: 1
    adaptive_pruning: true
    prune_threshold: 0.1
    use_cost: true          # âœ… ç¡®ä¿å¯ç”¨

  greedy_aopt:
    n_probes: 32            # âœ… ä» 16 æå‡åˆ° 32ï¼ˆæ›´ç¨³å®šï¼‰
    use_cost: true

  # ğŸ”¥ EVI Configuration - CRITICAL OPTIMIZATION
  greedy_evi:
    n_y_samples: 0         # ğŸ”¥ æ”¹ä¸º 0ï¼ˆè§£ææ³•æ›´å¿«ï¼‰
    use_cost: true
    mi_prescreen: true     # ğŸ”¥ ç¡®ä¿å¯ç”¨
    keep_fraction: 0.5     # ğŸ”¥ ä» 0.25 æ”¾å®½åˆ° 0.5


    # è¿è¡Œç­–ç•¥
    # ğŸ”¥ æ–°å¢å­é›†è¿è¡Œé…ç½®
    budgets_subset: []
    must_budgets: [10, 30]
    every_n_folds: 2
    max_folds: null

  maxmin:
    use_cost: true

# ----------------------------------------------------------------------------
# Expected Value of Information
# ----------------------------------------------------------------------------
evi:
  compute_for: ["greedy_mi", "greedy_aopt", "greedy_evi"]
  method: "monte_carlo"
  monte_carlo_samples: 20

# ----------------------------------------------------------------------------
# Cross-Validation
# ----------------------------------------------------------------------------
cv:
  scheme: "spatial_block"
  k_folds: 3
  buffer_width_multiplier: 1.5
  block_strategy: "kmeans"
  ensure_connected: true
  morans_permutations: 999

# ----------------------------------------------------------------------------
# Uncertainty Quantification
# ----------------------------------------------------------------------------
uq:
  bootstrap_method: "spatial_block"
  bootstrap_samples: 1000
  confidence_level: 0.95
  coverage_percentile: 90
  compute_crps: true

# ----------------------------------------------------------------------------
# Diagnostics
# ----------------------------------------------------------------------------
diagnostics:
  morans_i:
    compute: true
    permutations: 999
    alpha: 0.05

  calibration:
    pit_histogram: true
    coverage_curves: true
    reliability_diagram: true

# ----------------------------------------------------------------------------
# ğŸ”¥ Visualization - æ–°å¢ä¸šåŠ¡å‹å¥½å›¾è¡¨
# ----------------------------------------------------------------------------
plots:
  save_formats: [png, pdf]
  dpi: 300
  style: "seaborn-v0_8-paper"

  budget_curves:
    metrics: ["rmse", "expected_loss_gbp", "coverage_90"]
    show_confidence: true
    confidence_level: 0.95

  performance_profile:
    tau_values: [1.0, 1.05, 1.1, 1.2, 1.5, 2.0, 3.0]
    use_budget_fold_instances: true

  critical_difference:
    alpha: 0.05
    test: "nemenyi"

  # ğŸ”¥ æ–°å¢ï¼šä¸šåŠ¡å‹å¥½å›¾è¡¨é…ç½®
  business_metrics:
    enable: true
    baseline_method: "uniform"
    show_savings: true
    show_roi: true
    show_cost_efficiency: true

  # ğŸ”¥ æ–°å¢ï¼šæ•ˆåº”é‡åˆ†æ
  effect_size:
    enable: true
    plot_heatmaps: true
    plot_pairwise_table: true
    top_k_comparisons: 20

  # ğŸ”¥ æ–°å¢ï¼šè¿‘é˜ˆå€¼åŒºåŸŸåˆ†æ
  critical_region:
    enable: true
    epsilon: 0.2            # ä¸´ç•ŒåŒºåŸŸåŠå¾„ï¼ˆÏ„ Â± 0.2ï¼‰
    plot_heatmap: true

  expert_plots:
    enable_all: true

    marginal_efficiency:
      enable: true
      normalize_by_cost: true
      unit: "gbp_per_test_point"  # âœ… æ–°å¢å•ä½

    type_composition:
      enable: true
      show_cost_breakdown: true

    mi_voi_correlation:
      enable: true
      methods: ["greedy_mi", "greedy_evi"]

    calibration_plots:
      enable: true

    spatial_diagnostics:
      enable: true
      show_morans_i: true

    sensor_placement_map:
      enable: true
      budgets_to_show: [5, 10, 20, 30, 50]

    # ğŸ”¥ æ–°å¢å›¾è¡¨
    roi_curves:
      enable: true

    robustness_heatmap:
      enable: true
      ddi_range: [ 0.1, 0.2, 0.3, 0.4 ]
      loss_ratios: [ 1, 5, 10, 20 ]

    ddi_overlay:
      enable: true
# ----------------------------------------------------------------------------
# Acceptance Criteria
# ----------------------------------------------------------------------------
acceptance:
  m1_grid_size: 100
  m1_budgets: [5, 10, 20]
  m1_check_monotonic: true
  m1_check_diminishing: true

  m2_min_improvement_vs_random: 0.15
  m2_confidence_level: 0.95

  m3_small_instance_n: 25
  m3_small_instance_k: 5
  m3_max_suboptimality: 0.10

  m4_morans_alpha: 0.05
  m4_coverage_tolerance: 0.10
  m4_msse_tolerance: 0.25

# ============================================================================
# ğŸ”¥ å®éªŒåœºæ™¯é…ç½®ï¼ˆå¯é€‰ï¼šå¤šåœºæ™¯å¯¹æ¯”ï¼‰
# ============================================================================
scenarios:
  # åœºæ™¯ 1ï¼šç¨€ç–æ±  + é«˜ä»£ä»·
  - name: "sparse_high_stakes"
    active: true
    pool_fraction: 0.15
    tau_quantile: 0.90
    L_FN_gbp: 150000
    L_FP_gbp: 5000

  # åœºæ™¯ 2ï¼šå¯†é›†æ±  + ä¸­ä»£ä»·
  - name: "dense_medium_stakes"
    active: false
    pool_fraction: 0.30
    tau_quantile: 0.85
    L_FN_gbp: 100000
    L_FP_gbp: 8000

  # åœºæ™¯ 3ï¼šæç¨€ç– + æé«˜ä»£ä»·
  - name: "ultra_sparse_ultra_stakes"
    active: false
    pool_fraction: 0.10
    tau_quantile: 0.92
    L_FN_gbp: 200000
    L_FP_gbp: 4000

# ============================================================================
# ä¿®æ”¹è¯´æ˜
# ============================================================================
# ç›¸æ¯”åŸ configï¼Œä¸»è¦ä¿®æ”¹ï¼š
#
# 1. å†³ç­–æ¨¡å‹ï¼ˆ2å¤„ï¼‰:
#    - tau_quantile: 0.88ï¼ˆåŠ¨æ€é˜ˆå€¼ï¼‰
#    - FN:FP æ¯”ä¾‹æå‡åˆ° 20:1
#
# 2. ä¼ æ„Ÿå™¨æ± ï¼ˆ1å¤„ï¼‰:
#    - pool_fraction: 0.15ï¼ˆæ›´ç¨€ç–ï¼‰
#
# 3. EVI å‚æ•°ï¼ˆ2å¤„ï¼‰:
#    - keep_fraction: 0.7ï¼ˆä» 0.25ï¼‰
#    - n_y_samples: 8ï¼ˆå¯ç”¨ MCï¼‰
#
# 4. A-opt å‚æ•°ï¼ˆ1å¤„ï¼‰:
#    - n_probes: 32ï¼ˆæ›´ç¨³å®šï¼‰
#
# 5. æ–°å¢å¯è§†åŒ–ï¼ˆ3ç»„ï¼‰:
#    - business_metricsï¼ˆçœé’± + ROIï¼‰
#    - effect_sizeï¼ˆCliff's Deltaï¼‰
#    - critical_regionï¼ˆè¿‘é˜ˆå€¼åˆ†æï¼‰
#
# é¢„æœŸæ•ˆæœï¼š
#   - EVI vs MI å·®è·æ‹‰å¤§åˆ° 5-10%
#   - EVI è¿è¡Œæ—¶é—´é™è‡³ 1-2 åˆ†é’Ÿï¼ˆä» 43 åˆ†é’Ÿï¼‰
#   - æ€§èƒ½æ›²çº¿æ˜æ˜¾åˆ†ç¦»
#   - CD å›¾æ˜¾è‘—æ€§æå‡
# ============================================================================