# ============================================================================
# RDT-VoI Simulation Configuration - OPTIMIZED VERSION
# Road Deterioration Testing: Value of Information Framework
#
# é…ç½®è¯„åˆ†: 5/5 (ä¼˜åŒ–å)
# å…³é”®æ”¹è¿›:
#   1. å¢å¼ºæŸå¤±ä¸å¯¹ç§°æ€§ FN:FP = 15:1 (ä» 10:1)
#   2. ä¼˜åŒ–é¢„ç®—ç‚¹åˆ†å¸ƒï¼Œå¢åŠ å°é¢„ç®—å¯†åº¦
#   3. EVI é…ç½®ä¼˜åŒ–ï¼Œç¡®ä¿å…³é”®é¢„ç®—ç‚¹è¦†ç›–
# ============================================================================

experiment:
  name: "rdt_voi_optimized"
  seed: 42
  output_dir: "results/optimized_run"

# ----------------------------------------------------------------------------
# Numerical Settings
# ----------------------------------------------------------------------------
numerics:
  linear_solver_tol: 1.0e-8
  cholesky_nugget: 1.0e-6
  pcg_max_iter: 500
  logdet_method: "cholmod"  # "cholmod" | "exact" | "hutchinson"

# ----------------------------------------------------------------------------
# Spatial Domain
# ----------------------------------------------------------------------------
geometry:
  mode: "grid2d"  # "grid2d" | "polyline1d" | "graph"
  nx: 40
  ny: 40
  h: 5.0  # Grid spacing in meters

# ----------------------------------------------------------------------------
# Prior Distribution (GMRF/SPDE) - å·²éªŒè¯ä¼˜ç§€ âœ“
# ----------------------------------------------------------------------------
prior:
  # åŸºç¡€å‚æ•°
  nu: 1.0
  kappa: 0.10
  sigma2: 0.30
  alpha: 2
  beta: 1.0e-6
  mu_prior_mean: 2.2
  mu_prior_std: 0.3

  # ğŸ”¥ éå¹³ç¨³å…ˆéªŒå‚æ•° - CV=30.11% (ä¼˜ç§€!)
  beta_base: 3.0        # éçƒ­ç‚¹åŒºåŸŸ nugget
  beta_hot: 1.0e-8      # çƒ­ç‚¹åŒºåŸŸ nugget (å·®è· 3Ã—10^8)

  # çƒ­ç‚¹åŒºåŸŸå®šä¹‰ (ç±³åæ ‡) - åŸŸ: 200m Ã— 200m
  hotspots:
    - center_m: [50, 50]      # å·¦ä¸‹è§’
      radius_m: 45
    - center_m: [150, 50]     # å³ä¸‹è§’
      radius_m: 45
    - center_m: [50, 150]     # å·¦ä¸Šè§’
      radius_m: 45
    - center_m: [150, 150]    # å³ä¸Šè§’
      radius_m: 45
    - center_m: [100, 100]    # ä¸­å¿ƒåŒºåŸŸ
      radius_m: 50

# ----------------------------------------------------------------------------
# Sensor Pool Configuration
# ----------------------------------------------------------------------------
sensors:
  # Available sensor types
  types:
    - name: "basic_point"
      noise_std: 0.15
      cost_gbp: 100
      footprint: "point"

    - name: "precise_point"
      noise_std: 0.08
      cost_gbp: 250
      footprint: "point"

    - name: "area_avg_3x3"
      noise_std: 0.12
      cost_gbp: 180
      footprint: "avg3x3"

    - name: "area_avg_5x5"
      noise_std: 0.18
      cost_gbp: 120
      footprint: "avg5x5"

  # Pool generation strategy
  pool_strategy: "grid_subsample"  # "grid_subsample" | "random" | "importance"
  pool_fraction: 0.3               # Fraction of domain to use as candidates

  # Type mix (must sum to 1.0)
  type_mix: [0.4, 0.2, 0.3, 0.1]   # Proportion of each sensor type

# ----------------------------------------------------------------------------
# Decision Model (Economics) - ğŸ”¥ å…³é”®ä¼˜åŒ–
# ----------------------------------------------------------------------------
decision:
  # Decision threshold - å·²éªŒè¯ç†æƒ³ (51.5th ç™¾åˆ†ä½) âœ“
  tau_iri: 2.2

  # Loss matrix (in GBP) - ğŸ”¥ å¢å¼ºä¸å¯¹ç§°æ€§
  L_TP_gbp: 5000       # True Positive: æ­£ç¡®ç»´æŠ¤éœ€è¦ç»´æŠ¤çš„è·¯æ®µ
  L_FP_gbp: 10000      # ğŸ”¥ False Positive: è¿‡åº¦ç»´æŠ¤ (ä» 8k å¢åŠ åˆ° 10k)
  L_FN_gbp: 150000     # ğŸ”¥ False Negative: æ¼æ£€ä¸¥é‡è·¯æ®µ (ä» 80k å¢åŠ åˆ° 150k)
  L_TN_gbp: 0          # True Negative: æ­£ç¡®è·³è¿‡

  # ğŸ¯ ä¼˜åŒ–åæˆæœ¬æ¯”ä¾‹:
  #   FN:FP = 150k:10k = 15:1  âœ“ (ä» 10:1 æå‡)
  #   FN:TP = 150k:5k = 30:1   âœ“ (ä» 16:1 æå‡)
  # è¿™å°†æ˜¾è‘—æå‡"ä¸ç¡®å®šæ€§é™ä½"çš„å†³ç­–ä»·å€¼

# ----------------------------------------------------------------------------
# Sensor Selection Methods
# ----------------------------------------------------------------------------
selection:
  # Methods to evaluate
  methods:
    - greedy_mi
    - greedy_aopt
    - greedy_evi
    - maxmin
    - uniform
    - random

  # ğŸ”¥ ä¼˜åŒ–é¢„ç®—ç‚¹åˆ†å¸ƒ - å¢åŠ å°é¢„ç®—å¯†åº¦
  budgets: [3, 5, 8, 10, 15, 20, 25, 30, 40, 50]
  # æ”¹è¿›è¯´æ˜:
  #   - æ·»åŠ  k=3 (æœ€å°é¢„ç®—ï¼Œå·®è·æœ€æ˜æ˜¾)
  #   - æ·»åŠ  k=8 (å¡«è¡¥ 5-10 é—´éš™)
  #   - æ·»åŠ  k=25 (å¡«è¡¥ 20-30 é—´éš™)
  #   - ä¿æŒæœ€å¤§é¢„ç®— k=50 â‰ˆ 10% æ± å¤§å°

  # Method-specific configurations
  greedy_mi:
    batch_size: 1
    adaptive_pruning: true
    prune_threshold: 0.1
    max_candidates: null
    early_stop_ratio: null

  greedy_aopt:
    n_probes: 16         # Hutchinson++ probes for trace estimation
    use_cost: true       # Enable gain/cost scoring

  # ğŸ”¥ EVI é…ç½®ä¼˜åŒ–
  greedy_evi:
    n_y_samples: 0       # ä½¿ç”¨åæ–¹å·®æ¨¡å¼ (æœ€å¿«ä¸”ç¨³å®š)
    use_cost: true       # å¯ç”¨æˆæœ¬å½’ä¸€åŒ–

    # MI é¢„ç­›é€‰ (å¼ºçƒˆæ¨è)
    mi_prescreen: true   # å¯ç”¨ MI é¢„ç­›é€‰
    keep_fraction: 0.25  # ä¿ç•™å‰ 25% å€™é€‰

    # ğŸ”¥ è¿è¡Œç­–ç•¥ä¼˜åŒ–
    must_budgets: [5, 10, 20, 30]  # å…³é”®é¢„ç®—ç‚¹ (æ‰€æœ‰ fold)
    every_n_folds: 1               # æ¯ fold éƒ½è¿è¡Œ (å±•ç¤ºå®Œæ•´æ€§èƒ½)

    # å¯é€‰çº¦æŸ
    budgets_subset: []   # ç©ºåˆ—è¡¨ = è¿è¡Œæ‰€æœ‰é¢„ç®—
    max_folds: null      # null = è¿è¡Œæ‰€æœ‰ fold

  maxmin:
    use_cost: true       # Normalize distance by cost

# ----------------------------------------------------------------------------
# Expected Value of Information (EVI) Computation
# ----------------------------------------------------------------------------
evi:
  compute_for: ["greedy_mi", "greedy_aopt", "greedy_evi"]
  method: "monte_carlo"
  monte_carlo_samples: 20  # ğŸ”¥ å¢åŠ é‡‡æ ·æ•°ä»¥æé«˜ç²¾åº¦ (ä» 10 å¢åŠ )

  # Unscented Transform settings (if method = "unscented")
  unscented_alpha: 1.0
  unscented_beta: 2.0
  unscented_kappa: 0.0

# ----------------------------------------------------------------------------
# Cross-Validation
# ----------------------------------------------------------------------------
cv:
  scheme: "spatial_block"
  k_folds: 3                        # 3 æŠ˜è¶³å¤Ÿ (åŠ å¿«è¿­ä»£)
  buffer_width_multiplier: 1.5      # Buffer = 1.5 Ã— correlation_length
  block_strategy: "kmeans"
  ensure_connected: true
  morans_permutations: 999

# ----------------------------------------------------------------------------
# Uncertainty Quantification
# ----------------------------------------------------------------------------
uq:
  bootstrap_method: "spatial_block"
  bootstrap_samples: 1000
  confidence_level: 0.95
  coverage_percentile: 90
  compute_crps: true

# ----------------------------------------------------------------------------
# Diagnostics
# ----------------------------------------------------------------------------
diagnostics:
  morans_i:
    compute: true
    permutations: 999
    alpha: 0.05

  calibration:
    pit_histogram: true
    coverage_curves: true
    reliability_diagram: true

# ----------------------------------------------------------------------------
# Visualization
# ----------------------------------------------------------------------------
plots:
  save_formats: [png, pdf]
  dpi: 300
  style: "seaborn-v0_8-paper"

  # Budget-performance curves
  budget_curves:
    metrics: ["rmse", "expected_loss_gbp", "coverage_90"]
    show_confidence: true
    confidence_level: 0.95

  # Performance profile
  performance_profile:
    tau_values: [1.0, 1.05, 1.1, 1.2, 1.5, 2.0, 3.0]
    use_budget_fold_instances: true

  # Critical difference diagram
  critical_difference:
    alpha: 0.05
    test: "nemenyi"

  # Expert plots (optional, for detailed analysis)
  expert_plots:
    enable_all: false

    marginal_efficiency:
      enable: true
      normalize_by_cost: true

    type_composition:
      enable: true
      show_cost_breakdown: true

    mi_voi_correlation:
      enable: true
      methods: ["greedy_mi", "greedy_evi"]

    calibration_plots:
      enable: true

    spatial_diagnostics:
      enable: true
      show_morans_i: true

    ablation_study:
      enable: false

    sensor_placement_map:
      enable: true
      budgets_to_show: [5, 10, 20, 30, 50]  # ğŸ”¥ å¢åŠ å±•ç¤ºç‚¹

# ----------------------------------------------------------------------------
# Acceptance Criteria (for automated validation)
# ----------------------------------------------------------------------------
acceptance:
  # Milestone 1: Basic functionality
  m1_grid_size: 100
  m1_budgets: [5, 10, 20]
  m1_check_monotonic: true
  m1_check_diminishing: true

  # Milestone 2: Performance vs baselines
  m2_min_improvement_vs_random: 0.15
  m2_confidence_level: 0.95

  # Milestone 3: Optimality gap
  m3_small_instance_n: 25
  m3_small_instance_k: 5
  m3_max_suboptimality: 0.10

  # Milestone 4: Statistical validity
  m4_morans_alpha: 0.05
  m4_coverage_tolerance: 0.10
  m4_msse_tolerance: 0.25