# ============================================================================
# RDT-VoI Configuration - SCENARIO B: COMPUTE / ROBUSTNESS
# åœºæ™¯ Bï¼šç®—åŠ›/é²æ£’æ€§å¯¹æ¯” - å‡¸æ˜¾ MI ä½œä¸ºå¯æ‰©å±•ä»£ç†
#
# æ ¸å¿ƒç‰¹å¾ï¼š
#   - ä½ DDI (0.10): å†³ç­–æ•æ„Ÿåº¦ä½
#   - å¯¹ç§°/å¼±ä¸å¯¹ç§°ä»£ä»· (FN:FP = 1:1): è¯¯åˆ¤ä»£ä»·ç›¸å½“
#   - å¯†é›†å€™é€‰æ±  (60%): å……è¶³çš„é€‰ç‚¹ç©ºé—´
#   - æ— è¡ŒåŠ¨é™åˆ¶: å¯ç»´æŠ¤ä»»æ„æ•°é‡ä½ç½®
#   - æ›´å¤§é¢„ç®—èŒƒå›´: æµ‹è¯•è§„æ¨¡æ•ˆåº”
#
# é¢„æœŸç»“æœï¼šMI çš„"æ—¶é—´-æŸå¤±"æ•ˆç‡æ›´ä¼˜ï¼Œé”™é…é²æ£’æ€§æ›´å¼º
# ============================================================================

experiment:
  name: "rdt_voi_B_proxy"
  seed: 42
  output_dir: "results/B_proxy"

# ----------------------------------------------------------------------------
# Numerical Settings
# ----------------------------------------------------------------------------
numerics:
  linear_solver_tol: 1.0e-8
  cholesky_nugget: 1.0e-6
  pcg_max_iter: 500
  logdet_method: "cholmod"

# ----------------------------------------------------------------------------
# Spatial Domain (20x20 ç½‘æ ¼ï¼Œæ€» 400 åƒå…ƒ)
# ----------------------------------------------------------------------------
geometry:
  mode: "grid2d"
  nx: 20
  ny: 20
  h: 5.0

# ----------------------------------------------------------------------------
# Prior Distribution (GMRF/SPDE) - ç›¸åŒçš„å…ˆéªŒè®¾å®š
# ----------------------------------------------------------------------------
prior:
  nu: 1.0
  kappa: 0.12
  sigma2: 0.25
  alpha: 2
  beta: 1.0e-6
  mu_prior_mean: 2.2
  mu_prior_std: 0.3

  # çƒ­ç‚¹é…ç½®ï¼ˆç”¨äºç©ºé—´å¼‚è´¨æ€§ï¼‰
  beta_base: 5.0     # éçƒ­ç‚¹åŒºåŸŸçš„nuggetï¼ˆä½ä¸ç¡®å®šæ€§ï¼‰
  beta_hot: 1.0e-4   # çƒ­ç‚¹åŒºåŸŸçš„nuggetï¼ˆé«˜ä¸ç¡®å®šæ€§ï¼‰

  hotspots:
    - center_m: [25, 75]
      radius_m: 20
    - center_m: [75, 25]
      radius_m: 25
    - center_m: [50, 50]
      radius_m: 15

# ----------------------------------------------------------------------------
# Sensor Pool Configuration - ğŸ”¥ å¯†é›†æ± ï¼ˆ60%ï¼‰
# ----------------------------------------------------------------------------
sensors:
  types:
    - name: smartphone
      noise_std: 0.50
      cost_gbp: 30
      footprint: point

    - name: "basic_point"
      noise_std: 0.12
      cost_gbp: 150
      footprint: "point"

    - name: "laser_profiler"
      noise_std: 0.035
      cost_gbp: 800
      footprint: "point"

    - name: photogrammetry
      noise_std: 0.20
      cost_gbp: 100
      footprint: avg3x3

    - name: "vehicle_avg"
      noise_std: 0.30
      cost_gbp: 100
      footprint: "avg5x5"

    - name: inertial_profiler
      noise_std: 0.12
      cost_gbp: 300
      footprint: avg3x3

  pool_strategy: "grid_subsample"
  pool_fraction: 0.60  # ğŸ”¥ å¯†é›†æ± ï¼š240 ä¸ªå€™é€‰ä½ç½®ï¼ˆ400Ã—0.6ï¼‰
  type_mix: [0.15, 0.20, 0.10, 0.20, 0.15, 0.20]

  use_heterogeneous: true
  cost_zones:
    - center_m: [100, 100]
      radius_m: 50
      cost_multiplier: 1.5
      noise_multiplier: 0.8
      allowed_types: ['inertial_profiler', 'photogrammetry']

# ----------------------------------------------------------------------------
# Decision Model - ğŸ”¥ ä½é£é™©/å¯¹ç§°ä»£ä»·å‚æ•°
# ----------------------------------------------------------------------------
decision:
  # æ¨èï¼šåªä½¿ç”¨ tau_quantileï¼ˆåŠ¨æ€é˜ˆå€¼ï¼‰
  tau_iri: null  # âœ… è®¾ä¸ºnullï¼Œè®©main()ä¸­è‡ªåŠ¨è®¡ç®—å¹¶ç¼“å­˜
  tau_quantile: 0.65  # Scenario A: 0.88-0.90 | Scenario B: 0.60-0.70

  # ä»£ä»·çŸ©é˜µ
  L_FP_gbp: 5000.0       # ä¿æŒåŸå€¼ï¼ˆæˆ–ç•¥å¾®æé«˜ï¼‰
  L_FN_gbp: 30000.0      # ğŸ”¥ 120000 â†’ 30000ï¼ˆé™ä½ä¸å¯¹ç§°æ€§ï¼‰
  L_TP_gbp: 800.0
  L_TN_gbp: 0.0

  # ğŸ”¥ DDIæ§åˆ¶ï¼ˆä½¿ç”¨compute_ddi_with_targetè‡ªæ ‡å®šï¼‰
  target_ddi: 0.10  # Scenario A: 0.25-0.35 | Scenario B: 0.10-0.15
  K_action: 10      # Scenario A: 10 | Scenario B: null

metrics:
  scale_savings_to_domain: true  # âœ… å¯ç”¨åŸŸç¼©æ”¾ï¼ˆè®©æµ‹è¯•é›†æŸå¤±å¯æ¯”äºå…¨åŸŸæˆæœ¬ï¼‰
  coverage_clip: [0.0, 1.0]      # Coverage è£å‰ªèŒƒå›´
# ----------------------------------------------------------------------------
# Sensor Selection Methods - ğŸ”¥ å®½é¢„ç®—èŒƒå›´
# ----------------------------------------------------------------------------
selection:
  methods:
    - greedy_evi
    - greedy_mi
    - greedy_aopt
    - maxmin
    - uniform
    - random

  budget_type: "count"
  budgets: [3, 5, 10, 15, 20]

  greedy_mi:
    batch_size: 1
    adaptive_pruning: true
    prune_threshold: 0.10
    use_cost: true

  greedy_aopt:
    n_probes: 32
    use_cost: true

  greedy_evi:
    n_y_samples: 0
    use_cost: true
    mi_prescreen: true  # ä¸»å®éªŒä¿æŒtrueï¼›ç›¸å…³æ€§å®éªŒæ—¶è®¾false
    keep_fraction: 0.50  # Scenario A: 0.5 | Scenario B: 0.5

    # ğŸ”¥ å…³é”®ä¿®å¤ï¼šç¦ç”¨foldè·³è¿‡æœºåˆ¶
    every_n_folds: 1       # âœ… 1=è¿è¡Œæ‰€æœ‰foldï¼ˆä¸è·³è¿‡ï¼‰
    budgets_subset: []     # âœ… ç©ºåˆ—è¡¨=è¿è¡Œæ‰€æœ‰budget
    max_folds: null        # âœ… null=ä¸é™åˆ¶foldæ•°é‡
    must_budgets: []       # âœ… ä¸éœ€è¦ç‰¹æ®Šå¤„ç†çš„budget

  maxmin:
    use_cost: true

# ----------------------------------------------------------------------------
# Expected Value of Information - ğŸ”¥ é€‚åº¦é™é‡‡æ ·ï¼ˆæ¨¡æ‹Ÿç®—åŠ›å—é™ï¼‰
# ----------------------------------------------------------------------------
evi:
  compute_for: ["greedy_mi", "greedy_evi"]
  method: "monte_carlo"
  monte_carlo_samples: 16  # ğŸ”¥ 16 æ ·æœ¬ï¼šåœ¨ç®—åŠ›å—é™åœºæ™¯

# ----------------------------------------------------------------------------
# Cross-Validation
# ----------------------------------------------------------------------------
cv:
  scheme: "spatial_block"
  k_folds: 5  # ğŸ”¥ å»ºè®®è‡³å°‘5æŠ˜ï¼Œä»¥è·å¾—è¶³å¤Ÿå®ä¾‹æ•°ï¼ˆ5Ã—5 budgets = 25ï¼‰
  buffer_width_multiplier: 1.5
  block_strategy: "kmeans"
  ensure_connected: true
  morans_permutations: 999


# ----------------------------------------------------------------------------
# Uncertainty Quantification
# ----------------------------------------------------------------------------
uq:
  bootstrap_method: "spatial_block"
  bootstrap_samples: 1000
  confidence_level: 0.95
  coverage_percentile: 90
  compute_crps: true

# ----------------------------------------------------------------------------
# Diagnostics
# ----------------------------------------------------------------------------
diagnostics:
  morans_i:
    compute: true
    permutations: 999
    alpha: 0.05

  calibration:
    pit_histogram: true
    coverage_curves: true
    reliability_diagram: true

# ----------------------------------------------------------------------------
# ğŸ”¥ Visualization - çªå‡º MI çš„æ•ˆç‡ä¸é²æ£’æ€§
# ----------------------------------------------------------------------------
plots:
  save_formats: [png, pdf]
  dpi: 300
  style: "seaborn-v0_8-paper"

  budget_curves:
    metrics: ["rmse", "expected_loss_gbp", "coverage_90"]
    show_confidence: true
    confidence_level: 0.95

  performance_profile:
    tau_values: [1.0, 1.05, 1.1, 1.2, 1.5, 2.0, 3.0]
    use_budget_fold_instances: true

  critical_difference:
    alpha: 0.05
    test: "nemenyi"

  business_metrics:
    enable: true
    baseline_method: "uniform"  # ğŸ”¥ å›ºå®šbaseline
    show_savings: true     # Scenario A: true | Scenario B: false
    show_roi: true
    show_cost_efficiency: true

  effect_size:
    enable: true
    plot_heatmaps: true
    plot_pairwise_table: true
    top_k_comparisons: 20

  critical_region:
    enable: true   # Scenario A: true | Scenario B: false
    epsilon: 0.2
    plot_heatmap: true

  expert_plots:
    enable_all: true

    # ğŸ”¥ æ ¸å¿ƒå·®å¼‚ç‚¹ï¼šæ—¶é—´-æŸå¤±æ•ˆç‡ï¼ˆScenario B ç‰¹æœ‰ï¼‰
    # éœ€è¦åœ¨ main.py ä¸­è®°å½•å¢™é’Ÿæ—¶é—´
    time_loss_curves:
      enable: true   # âœ… Scenario B ç‰¹æœ‰
      wallclock_limits: [5, 30, 120]  # ç»Ÿä¸€æ—¶é—´é¢„ç®—

    # ğŸ”¥ é²æ£’æ€§çƒ­å›¾ï¼ˆå…ˆéªŒé”™é…æµ‹è¯•ï¼‰
    robustness_heatmap:
      enable: true   # âœ… Scenario B ç‰¹æœ‰
      kappa_multipliers: [0.5, 0.7, 1.0, 1.3, 1.5]  # å…ˆéªŒé”™é…
      loss_ratios: [1, 3, 5, 10, 25]  # L_FN/L_FP æ¯”ç‡

    # ğŸ”¥ ä¸å¯ç”¨ near-threshold åˆ†æï¼ˆä½ DDI ä¸‹ä¸æ˜¯é‡ç‚¹ï¼‰
    critical_region:
      enable: false  # Scenario B ä¸éœ€è¦

    ddi_overlay:
      enable: false  # Scenario B ä¸éœ€è¦

    roi_curves:
      enable: true
      baseline_method: "uniform"
      show_near_threshold: false  # ğŸ”¥ Scenario B ä¸å±•ç¤º

    marginal_efficiency:
      enable: true
      normalize_by_cost: true
      unit: "gbp_per_test_point"
      # ğŸ”¥ æ–°å¢ï¼šåˆ†å›¾æ˜¾ç¤ºä¸åŒå•ä½
      split_by_unit: true

    type_composition:
      enable: true
      show_cost_breakdown: true

    mi_voi_correlation:
      enable: true
      methods: ["greedy_mi", "greedy_evi"]
      # ğŸ”¥ ç›¸å…³æ€§å®éªŒï¼šæš‚æ—¶ç¦ç”¨MIé¢„ç­›é€‰
      correlation_mode_disable_prescreen: false

    calibration_plots:
      enable: true  # å¯ç§»åˆ°é™„å½•

    spatial_diagnostics:
      enable: true
      show_morans_i: true

    sensor_placement_map:
      enable: true
      budgets_to_show: [5, 10, 15, 20]


# ----------------------------------------------------------------------------
# Acceptance Criteria
# ----------------------------------------------------------------------------
acceptance:
  m1_grid_size: 100
  m1_budgets: [5, 10, 20]
  m1_check_monotonic: true
  m1_check_diminishing: true

  m2_min_improvement_vs_random: 0.15
  m2_confidence_level: 0.95

  m3_small_instance_n: 25
  m3_small_instance_k: 5
  m3_max_suboptimality: 0.10

  m4_morans_alpha: 0.05
  m4_coverage_tolerance: 0.10
  m4_msse_tolerance: 0.25

# ============================================================================
# åœºæ™¯ B é¢„æœŸç»“æœ
# ============================================================================
# 1. åœ¨ç»Ÿä¸€å¢™é’Ÿæ—¶é—´ä¸‹ï¼ˆ5s/30s/120sï¼‰ï¼š
#    - MI çš„"æ—¶é—´-æŸå¤±"æ›²çº¿æ–œç‡æ›´å¤§ï¼ˆå•ä½æ—¶é—´é™æŸæ›´å¤šï¼‰
#    - MI åœ¨å¤§é¢„ç®—æ®µï¼ˆn=40ï¼‰çš„è¾¹é™…æ•ˆç›Šä»ä¿æŒ
#
# 2. é²æ£’æ€§æµ‹è¯•ï¼ˆå…ˆéªŒé”™é… Â±50% kappaï¼‰ï¼š
#    - MI çš„æ€§èƒ½æ³¢åŠ¨æ›´å°ï¼ˆCliff's Delta < 0.2ï¼‰
#    - EVI å¯¹å…ˆéªŒé”™é…æ›´æ•æ„Ÿ
#
# 3. æŸå¤±å·®è·ï¼š
#    - EVI vs MI çš„æœŸæœ›æŸå¤±å·®å¼‚ < 3%ï¼ˆä¸æ˜¾è‘—ï¼‰
#    - åœ¨ä½ DDI åœºæ™¯ï¼ŒVoI çš„è¶…é¢æ”¶ç›Šè¢«æ‘Šè–„
#
# 4. ç®—åŠ›ç»Ÿè®¡ï¼š
#    - MI çš„ CPU æ—¶é—´/å¢™é’Ÿæ—¶é—´æ¯” EVI ä½ 5-10 å€
#    - MI çš„å†…å­˜å ç”¨æ›´ç¨³å®š
# ============================================================================