# =====================================================================
# RDT Sensor Optimization - ä¿®å¤åçš„é…ç½®
# =====================================================================
# ä¸»è¦ä¿®æ”¹ï¼š
# 1. é‡çº²åŒ¹é…ï¼šÎ¼=2.2, Ïƒ=0.55, Ï„=2.0ï¼ˆè®©Ï„åœ¨Î¼Â±2ÏƒèŒƒå›´å†…ï¼‰
# 2. å†—ä½™å¢å¼ºï¼špool_fraction=0.75, footprint=avg3x3ï¼ˆå¢åŠ é‡å ï¼‰
# 3. ç›¸å…³ç¼©çŸ­ï¼škappa=0.10ï¼ˆç›¸å…³é•¿åº¦â‰ˆ28mï¼‰
# 4. EVIæ–¹æ³•ï¼šæ”¹ç”¨monte_carloï¼ˆä½¿ç”¨ä¿®å¤åçš„ç®—æ³•ï¼‰

experiment:
  name: rdt_sensor_optimization_v1
  output_dir: runs
  seed: 202501

# ---------------------------------------------------------------------
# æ•°å€¼è®¡ç®—å‚æ•°
# ---------------------------------------------------------------------
numerics:
  linear_solver_tol: 1.0e-08
  cholesky_nugget: 1.0e-09
  logdet_method: cholesky
  pcg_max_iter: 1000

# ---------------------------------------------------------------------
# ç©ºé—´å‡ ä½•é…ç½®
# ---------------------------------------------------------------------
geometry:
  mode: grid2d
  nx: 40
  ny: 40
  h: 5.0  # ç½‘æ ¼é—´è·5m

# ---------------------------------------------------------------------
# å…ˆéªŒåˆ†å¸ƒå‚æ•°ï¼ˆMatÃ©rn GMRFï¼‰
# ğŸ”§ ä¿®æ”¹ï¼šé‡çº²åŒ¹é… + ç¼©çŸ­ç›¸å…³é•¿åº¦
# ---------------------------------------------------------------------
prior:
  nu: 1.0              # å¹³æ»‘åº¦å‚æ•°
  kappa: 0.10          # ğŸ”§ 0.08â†’0.10ï¼ˆç›¸å…³é•¿åº¦â‰ˆ28mï¼ŒåŸ35mï¼‰
  sigma2: 0.30         # ğŸ”§ 0.04â†’0.30ï¼ˆÏƒâ‰ˆ0.55ï¼ŒåŸ0.2ï¼‰
  alpha: 2             # SPDEé˜¶æ•°
  beta: 1.0e-06        # æ­£å®šåŒ–nugget
  mu_prior_mean: 2.2   # ğŸ”§ 1.5â†’2.2ï¼ˆæé«˜å‡å€¼ï¼Œè®©Ï„=2.0åœ¨åˆ†å¸ƒä¸­ï¼‰
  mu_prior_std: 0.0    # å¸¸æ•°å‡å€¼åœº

# ---------------------------------------------------------------------
# ä¼ æ„Ÿå™¨é…ç½®
# ğŸ”§ ä¿®æ”¹ï¼šå¢åŠ å¯†åº¦ + é‡å è¶³è¿¹
# ---------------------------------------------------------------------
sensors:
  pool_fraction: 0.75           # ğŸ”§ 0.25â†’0.75ï¼ˆ3å€å¯†åº¦ï¼‰
  pool_strategy: grid_subsample # ä¿æŒè§„åˆ™é‡‡æ ·
  type_mix:
    - 0.4  # inertial_profiler
    - 0.4  # photogrammetry
    - 0.2  # smartphone

  types:
    # é«˜ç²¾åº¦æƒ¯æ€§è½®å»“ä»ª
    - name: inertial_profiler
      noise_std: 0.1
      cost_gbp: 10000.0
      footprint: avg3x3  # ğŸ”§ pointâ†’avg3x3ï¼ˆäº§ç”Ÿé‡å ï¼‰

    # ä¸­ç­‰ç²¾åº¦æ‘„å½±æµ‹é‡
    - name: photogrammetry
      noise_std: 0.25
      cost_gbp: 5000.0
      footprint: avg3x3  # ä¿æŒ

    # ä½æˆæœ¬æ™ºèƒ½æ‰‹æœº
    - name: smartphone
      noise_std: 0.5
      cost_gbp: 500.0
      footprint: avg5x5  # ä¿æŒï¼ˆå¤§æ ¸ï¼‰

# ---------------------------------------------------------------------
# å†³ç­–æ¨¡å‹å‚æ•°
# ğŸ”§ ä¿®æ”¹ï¼šé˜ˆå€¼é™ä½åˆ°åˆ†å¸ƒèŒƒå›´å†…
# ---------------------------------------------------------------------
decision:
  tau_iri: 2.0        # ğŸ”§ 2.7â†’2.0ï¼ˆè®©Ï„âˆˆ[Î¼-2Ïƒ,Î¼+2Ïƒ]ï¼‰
  L_TP_gbp: 5000.0    # æ­£ç¡®ç»´æŠ¤æˆæœ¬
  L_FP_gbp: 8000.0    # è¯¯æŠ¥æˆæœ¬
  L_FN_gbp: 40000.0   # æ¼æŠ¥æˆæœ¬ï¼ˆä¸¥é‡ï¼‰
  L_TN_gbp: 0.0       # æ­£ç¡®ä¸ç»´æŠ¤

# ---------------------------------------------------------------------
# ä¼ æ„Ÿå™¨é€‰æ‹©ç®—æ³•
# ---------------------------------------------------------------------
selection:
  methods:
    - greedy_mi
    - greedy_aopt
    - uniform
    - random

  budgets:
    - 5
    - 10
    - 20
    - 40
    - 60
    - 80

  greedy_mi:
    lazy: true
    cost_normalized: true    # âœ… ä¿æŒï¼ˆå¯ç”¨æˆæœ¬çº¦æŸï¼‰
    warmstart_enum: false

  greedy_aopt:
    lazy: true
    trace_estimator: hutchpp
    hutchpp_probes: 20

# ---------------------------------------------------------------------
# EVIè®¡ç®—é…ç½®
# ğŸ”§ ä¿®æ”¹ï¼šæ”¹ç”¨ä¿®å¤åçš„monte_carloæ–¹æ³•
# ---------------------------------------------------------------------
evi:
  compute_for:
    - greedy_mi
  method: monte_carlo        # ğŸ”§ unscentedâ†’monte_carlo
  monte_carlo_samples: 1000  # ğŸ”§ 500â†’1000ï¼ˆæé«˜ç²¾åº¦ï¼‰
  unscented_alpha: 1.0       # ä¿ç•™ï¼ˆå¦‚éœ€åˆ‡æ¢å›UTï¼‰
  unscented_beta: 2.0
  unscented_kappa: 0.0

# ---------------------------------------------------------------------
# ç©ºé—´äº¤å‰éªŒè¯
# ---------------------------------------------------------------------
cv:
  scheme: spatial_block
  k_folds: 5
  buffer_width_multiplier: 1.5
  block_strategy: kmeans
  ensure_connected: true

# ---------------------------------------------------------------------
# ä¸ç¡®å®šæ€§é‡åŒ–
# ---------------------------------------------------------------------
uq:
  bootstrap_method: spatial_block
  bootstrap_samples: 1000
  confidence_level: 0.95
  coverage_percentile: 90
  compute_crps: false

# ---------------------------------------------------------------------
# è¯Šæ–­æŒ‡æ ‡
# ---------------------------------------------------------------------
diagnostics:
  morans_i:
    permutations: 999
    weight_type: adjacency
  calibration:
    compute_coverage: true
    compute_msse: true

# ---------------------------------------------------------------------
# å¯è§†åŒ–é…ç½®
# ---------------------------------------------------------------------
plots:
  save_formats:
    - png
    - pdf
  dpi: 300
  style: seaborn-v0_8-paper

  budget_curves:
    show_ci: true
    metrics:
      - expected_loss
      - rmse
      - mae

  performance_profile:
    tau_max: 3.0

  critical_difference:
    alpha: 0.05
    test: nemenyi

# ---------------------------------------------------------------------
# æ—¥å¿—é…ç½®
# ---------------------------------------------------------------------
logging:
  level: INFO
  console: true
  file: true
  jsonl_metrics: true

# ---------------------------------------------------------------------
# éªŒæ”¶æ ‡å‡†
# ---------------------------------------------------------------------
acceptance:
  # M1: å°è§„æ¨¡éªŒè¯
  m1_grid_size: 1600
  m1_budgets: [10, 20, 40]
  m1_check_monotonic: true
  m1_check_diminishing: true

  # M2: åŸºçº¿æ¯”è¾ƒ
  m2_min_improvement_vs_random: 0.15
  m2_confidence_level: 0.95

  # M3: è¿‘ä¼¼æ¯”éªŒè¯
  m3_small_instance_n: 200
  m3_small_instance_k: 8
  m3_max_suboptimality: 1.58

  # M4: ç©ºé—´è¯Šæ–­
  m4_morans_alpha: 0.05
  m4_coverage_tolerance: 0.05
  m4_msse_tolerance: 0.2